---
Author: Maxim Orlovsky
Proposed: 20 Jul 2025
---

# RGB tapret wallet descriptors

This standard defines output script descriptors for RGB-compatible bitcoin wallets
covering **tapret** commitment scheme and based on [BIP-380], [RGB-1] and [RGB-380] specifications.

## Motivation

The standard [RGB-380] defines output script descriptors for RGB-enabled wallets.
This covers RGB opret commitment scheme (see [RGB-1] specification), however,
the second RGB-supported commitment scheme **tapret** requires storing a set of
of applied **tapret tweaks** for the wallet-related UTXO set.

This specification introduces necessary additions to RGB wallet descriptors which
provide the required functionality.

## Specification

This specification is based on and compatible with [BIP-380] and [BIP-386].
It also uses conventions (like expression types, allowed characters, etc) from them.

It defines a new `tapret()` and `tweaks()` script expressions and a new `TWEAKSET` expression.

### `tapret()`

The `tapret()` script expression has a form `tapret(SCRIPT,tweaks(TWEAKSET,...))`.
The expression MUST BE a direct first argument of a `rgb()` script expression defined in [RGb-380].

The expression takes two arguments.
The first argument MUST BE a valid taproot Bitcoin script descriptor (`tr()` script expression)
as defined by [BIP-386] standard.

The second argument MUST BE a `tweaks()` expression as defined below.

### `tweaks()`

The `tweaks()` expression MUST contain a list of tweaks applied to a specific script derivation
points generated by the script descriptor provided as the first argument in
`tapret(...)` script expression.

### `TWEAKSET` expression

The expression contains a set of 256-bit **tapret tweaks** encoded as Base58 little endian values
applied to a specific derivation path.

The expression has a form of `/KEYCHAIN/INDEX/<TWEAK;+>`, where:
- `KEYCHAIN` is a keychain segment of a derivation path (see [BIP-43]; usually this is the
  first component in `XPUB/*/*` or `XPUB/<0;1>/*` expression),
- `INDEx` is a concrete derivation index used as a final fragment of the derivation path
  (the last component in `XPUB/<0;1>/*` expression).

`<TWEAK;*>` signifies a list of individual tweaks enclosed in angular brakets and separated
with a semicolon (`;`). The list may contain a single or multiple elements.
If the list contains a single element, the angular brackets SHOULD BE skipped, and no semicolon
MUST BE used.

The individual tapret tweak values are encoded using Base58 little endian encoding,
with no prefix nor checksum.

## Reference implementation

RGB tapret descriptors are implemented in [`rgb-descriptors`] rust crate.
Its source code is available on [GitHub].

## Rationale

### Base58 encoding of `TWEAKS` (tapret tweaks)

Base58 is selected since it is used in encoding extended keys, and output descriptors
parsers already have it as a dependency.

However, unlike extended keys, no prefix (like `xpub`/`xprv`) is added, since the number
of tapret tweaks may grow orders of magnitude larger than the numer of used keys,
and adding additional four characters may significantly increase the descriptor size.
The noise part of seal definitions is anyway clearly visually differentiated from the rest
of descriptor (via use of dedicated `tweaks()`), and thus any user confusion is improbable.

### Use of angular brackets and semicolon

To provide a set of multiple tapret tweaks we use angular brackets and semicolons in the
same manner as they are used in the [BIP-88] standard, which allows parser code re-use
and user convenience.

## Test vectors

### Correct descriptors

- Tapret descriptor with no tapret tweaks

        rgb(
            tapret(
                tr([643a7adc/86h/1h/0h]tpubDCNiWHaiSkgnQjuhsg9kjwaUzaxQjUcmhagvYzqQ3TYJTgFGJstVaqnu4yhtFktBhCVFmBNLQ5sN53qKzZbMksm3XEyGJsEhQPfVZdWmTE2/<0;1>/*),
                tweaks()
            ),
            seals(),
            ab0ad54f432146f9a8108dbf0f7d38bd3e3657bf4c873a9907befd579319f038
        )

- Tapret descriptor with a single tapreat tweak applied to `/0/1` derivation path

        rgb(
            tapret(
                tr([643a7adc/86h/1h/0h]tpubDCNiWHaiSkgnQjuhsg9kjwaUzaxQjUcmhagvYzqQ3TYJTgFGJstVaqnu4yhtFktBhCVFmBNLQ5sN53qKzZbMksm3XEyGJsEhQPfVZdWmTE2/<0;1>/*),
                tweaks(/0/1/xUGpuwjSUfFQ53BB6PCh36sjttPpYqXq6tNPXw2mC28mo)
            ),
            seals(),
            ab0ad54f432146f9a8108dbf0f7d38bd3e3657bf4c873a9907befd579319f038
        )
- 
- Tapret descriptor with a single tapreat tweak applied to `/0/1` derivation path,
  using excessive angular brackets

        rgb(
            tapret(
                tr([643a7adc/86h/1h/0h]tpubDCNiWHaiSkgnQjuhsg9kjwaUzaxQjUcmhagvYzqQ3TYJTgFGJstVaqnu4yhtFktBhCVFmBNLQ5sN53qKzZbMksm3XEyGJsEhQPfVZdWmTE2/<0;1>/*),
                tweaks(/0/1/<xUGpuwjSUfFQ53BB6PCh36sjttPpYqXq6tNPXw2mC28mo>)
            ),
            seals(),
            ab0ad54f432146f9a8108dbf0f7d38bd3e3657bf4c873a9907befd579319f038
        )

- Tapret descriptor with two tapreat tweaks applied to distinct derivation paths

        rgb(
            tapret(
                tr([643a7adc/86h/1h/0h]tpubDCNiWHaiSkgnQjuhsg9kjwaUzaxQjUcmhagvYzqQ3TYJTgFGJstVaqnu4yhtFktBhCVFmBNLQ5sN53qKzZbMksm3XEyGJsEhQPfVZdWmTE2/<0;1>/*),
                tweaks(
                    /0/1/xUGpuwjSUfFQ53BB6PCh36sjttPpYqXq6tNPXw2mC28mo,
                    /1/0/szpHvMPBKt4t9PagDS68oqS8dUc1gZTUPFV5p9Wgh4rF4
                )
            ),
            seals(),
            ab0ad54f432146f9a8108dbf0f7d38bd3e3657bf4c873a9907befd579319f038
        )

- Tapret descriptor with two tapreat tweaks applied to the same derivation path

        rgb(
            tapret(
                tr([643a7adc/86h/1h/0h]tpubDCNiWHaiSkgnQjuhsg9kjwaUzaxQjUcmhagvYzqQ3TYJTgFGJstVaqnu4yhtFktBhCVFmBNLQ5sN53qKzZbMksm3XEyGJsEhQPfVZdWmTE2/<0;1>/*),
                tweaks(
                    /0/1/xUGpuwjSUfFQ53BB6PCh36sjttPpYqXq6tNPXw2mC28mo,
                    /1/0/<Lyundr2Zsp9JfZbDzSmkRTST46jD93CjGqkZkaBcZf96r;szpHvMPBKt4t9PagDS68oqS8dUc1gZTUPFV5p9Wgh4rF4>
                )
            ),
            seals(),
            ab0ad54f432146f9a8108dbf0f7d38bd3e3657bf4c873a9907befd579319f038
        )

### Invalid descriptors

- Tapret descriptor with invalid tapret tweak data

        rgb(
            tapret(
                tr([643a7adc/86h/1h/0h]tpubDCNiWHaiSkgnQjuhsg9kjwaUzaxQjUcmhagvYzqQ3TYJTgFGJstVaqnu4yhtFktBhCVFmBNLQ5sN53qKzZbMksm3XEyGJsEhQPfVZdWmTE2/<0;1>/*),
                tweaks(/0/0/abjopjf)
            ),
            seals(),
            ab0ad54f432146f9a8108dbf0f7d38bd3e3657bf4c873a9907befd579319f038
        )


- Tapret descriptor with invalid tapret derivation paths

        rgb(
            tapret(
                tr([643a7adc/86h/1h/0h]tpubDCNiWHaiSkgnQjuhsg9kjwaUzaxQjUcmhagvYzqQ3TYJTgFGJstVaqnu4yhtFktBhCVFmBNLQ5sN53qKzZbMksm3XEyGJsEhQPfVZdWmTE2/<0;1>/*),
                tweaks(/0/0/0/xUGpuwjSUfFQ53BB6PCh36sjttPpYqXq6tNPXw2mC28mo)
            ),
            seals(),
            ab0ad54f432146f9a8108dbf0f7d38bd3e3657bf4c873a9907befd579319f038
        )

        rgb(
            tapret(
                tr([643a7adc/86h/1h/0h]tpubDCNiWHaiSkgnQjuhsg9kjwaUzaxQjUcmhagvYzqQ3TYJTgFGJstVaqnu4yhtFktBhCVFmBNLQ5sN53qKzZbMksm3XEyGJsEhQPfVZdWmTE2/<0;1>/*),
                tweaks(/1/*/xUGpuwjSUfFQ53BB6PCh36sjttPpYqXq6tNPXw2mC28mo)
            ),
            seals(),
            ab0ad54f432146f9a8108dbf0f7d38bd3e3657bf4c873a9907befd579319f038
        )

        rgb(
            tapret(
                tr([643a7adc/86h/1h/0h]tpubDCNiWHaiSkgnQjuhsg9kjwaUzaxQjUcmhagvYzqQ3TYJTgFGJstVaqnu4yhtFktBhCVFmBNLQ5sN53qKzZbMksm3XEyGJsEhQPfVZdWmTE2/<0;1>/*),
                tweaks(/<0;1>/0/xUGpuwjSUfFQ53BB6PCh36sjttPpYqXq6tNPXw2mC28mo)
            ),
            seals(),
            ab0ad54f432146f9a8108dbf0f7d38bd3e3657bf4c873a9907befd579319f038
        )

- Tapret descriptor with an excessive semicolon

        rgb(
            tapret(
                tr([643a7adc/86h/1h/0h]tpubDCNiWHaiSkgnQjuhsg9kjwaUzaxQjUcmhagvYzqQ3TYJTgFGJstVaqnu4yhtFktBhCVFmBNLQ5sN53qKzZbMksm3XEyGJsEhQPfVZdWmTE2/<0;1>/*),
                tweaks(/0/1/<xUGpuwjSUfFQ53BB6PCh36sjttPpYqXq6tNPXw2mC28mo;>)
            ),
            seals(),
            ab0ad54f432146f9a8108dbf0f7d38bd3e3657bf4c873a9907befd579319f038
        )

- Tapret descriptor with an excessive colon

        rgb(
            tapret(
                tr([643a7adc/86h/1h/0h]tpubDCNiWHaiSkgnQjuhsg9kjwaUzaxQjUcmhagvYzqQ3TYJTgFGJstVaqnu4yhtFktBhCVFmBNLQ5sN53qKzZbMksm3XEyGJsEhQPfVZdWmTE2/<0;1>/*),
                tweaks(
                    /0/1/xUGpuwjSUfFQ53BB6PCh36sjttPpYqXq6tNPXw2mC28mo,
                )
            ),
            seals(),
            ab0ad54f432146f9a8108dbf0f7d38bd3e3657bf4c873a9907befd579319f038
        )


[BIP-43]: https://github.com/bitcoin/bips/blob/master/bip-0043.mediawiki

[BIP-88]: https://github.com/bitcoin/bips/blob/master/bip-0088.mediawiki

[BIP-380]: https://github.com/bitcoin/bips/blob/master/bip-0380.mediawiki

[BIP-386]: https://github.com/bitcoin/bips/blob/master/bip-0386.mediawiki

[`rgb-descriptors`]: https://crates.io/crates/rgb-descriptors

[GitHub]: https://github.com/RGB-WG/rgb/tree/master/descriptors/src

[RGB-1]: https://github.com/RGB-WG/RFC/blob/master/RGB-1.md
